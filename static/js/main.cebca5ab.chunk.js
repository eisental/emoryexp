(this.webpackJsonpexp2021=this.webpackJsonpexp2021||[]).push([[0],{21:function(e,t,i){},22:function(e,t,i){},26:function(e,t,i){"use strict";i.r(t);var n=i(2),s=i.n(n),a=i(16),r=i.n(a),c=(i(21),i(3)),o=i(4),l=i(11),d=i(10),u=i(9),p=(i(22),i(1)),h=i.n(p),_=i(6),j="https://sheets.googleapis.com/v4/spreadsheets/",b=function(e){var t=[];return e.sheets.forEach((function(e){t.push(e.properties.title)})),t},m={read:function(e,t,i){return fetch(j+e.spreadsheet_id+"/values/"+t+"!"+i+"?key="+e.api_key)},write:function(e,t,i){Array.isArray(i)||(i=[i]);var n=e.write_url+"?sheet_name="+t;return fetch(n,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",mode:"no-cors",body:JSON.stringify(i)})},list_sheets:function(e){return fetch(j+e.spreadsheet_id+"?key="+e.api_key).then((function(e){return e.json()})).then(b)}},g="Sessions",f="SESSION_START",x="SESSION_CONTINUED",v="SESSION_END",O=function(e){var t=[];return e.values.forEach((function(e){var i={id:e[0],session:e[1],event:e[2],time:e[3]};t.push(i)})),t},y=function(e,t,i,n){var s=Object.assign({event:i,time:(new Date).toString()},t);m.write(e,g,s).catch(n)},S=function(e){return m.read(e,g,"A2:E10000").then((function(e){return e.json()})).then(O)},k=function(e,t){return m.list_sheets(e).then((function(e){return e.includes(t)}))},w=i(0),E={continue_label:"Proceed",subject_id_label:"Participant number:",group_label:"Group:",group_options:["Israeli musician","Israeli non-musician","American musician","American non-musician"],introduction:Object(w.jsxs)(s.a.Fragment,{children:[Object(w.jsx)("p",{children:'This experiment has a single task, repeated many times. In each trial, you will see two pictures and hear a voice, singing or speaking. Your task is to select the picture that better matches, according to your subjective intuition or "feeling," what the voice seems to express.'}),Object(w.jsx)("p",{children:'The experiment begins with a short practice session, followed by 4 "blocks" of trials. There will be pauses between blocks. The duration of each pause is self-timed. Four additional blocks will be presented in the 2nd session of the experiment, to be conducted in about a week.'}),Object(w.jsx)("p",{children:"The duration of each session is approximately 1 hour."}),Object(w.jsx)("p",{children:'Press "proceed" to continue.'})]}),subject_data:{header:Object(w.jsx)("p",{children:"Thank you for your participation in this experiment. Please provide the following information:"}),musical_instrument:Object(w.jsx)("p",{children:'Have you studied a musical instrument formally (including vocal training)? If you have, please specity for how many years. If you have not, choose "0".'}),music_theory:Object(w.jsx)("p",{children:'Have you studied music theory formally? If you have, please specify for how many years. If you have not, choose "0".'}),musical_activity:Object(w.jsx)("p",{children:"Are you currently involved in any musical activity (excluding passive listening) professionaly or as a serious hobby?"}),musical_activity_specify:Object(w.jsx)("p",{children:"If you are, please specify"}),acting:Object(w.jsx)("p",{children:"Have you been involved in acting (professionally or as a serious hobby)?"}),done:Object(w.jsx)("p",{children:'When done, please press "proceed"'}),validation:"Please complete all cells before pressing proceed",gender:"Gender",gender_male:"Male",gender_female:"Female",gender_other:"Other",age:"Age",yes:"Yes",no:"No"},picture_samples:{intro:Object(w.jsxs)(s.a.Fragment,{children:[Object(w.jsx)("p",{children:"Let's have a look at the pictures used in the experiment."}),Object(w.jsx)("p",{children:"In some pictures you see 2 objects contrasting in a particular feature. An arrow points at one of the objects. This is the object the picture referes to. The other object is presented for comparison. For instance:"})]}),other_pictures:Object(w.jsx)("p",{children:"Other pictures are comprised of a series of drawings, depicting a process or action. The arrows in these series denote the temporal order of the drawings."}),proceed:Object(w.jsx)("p",{children:'Press "proceed" when ready to continue.'}),semantic_field:Object(w.jsx)("p",{children:'Here are additional 4 pictures used in the experiment. Please note these pictures and their relationships. Press "proceed" when ready to continue.'}),semantic_field_first:Object(w.jsx)("p",{children:'Here are 4 pictures to be used in the experiment. Please note these pictures and their relationships. Press "proceed" when ready to continue.'})},practice_info:Object(w.jsxs)(s.a.Fragment,{children:[Object(w.jsx)("p",{children:'In the following practice trials, you will see two pictures and hear a voice, singing or speaking. Your task is to select the picture that better matches, according to your subjective intuition or "feeling," what the voice seems to express.'}),Object(w.jsx)("p",{children:'Please press "proceed" to begin the practice trials.'})]}),trial_instructions:Object(w.jsx)("p",{children:'Please click the sound icon and listen to the voice recording. After listening to the entire recording, click the picture that better matches the meaning that the voice seems to express, according to your intuition or "feeling." If you are unsure, you may listen again, by re-clicking the sound icon. Once you click one of the pictures, you will move to the next screen.'}),experiment_info:Object(w.jsxs)(s.a.Fragment,{children:[Object(w.jsx)("p",{children:"We now begin the experiment"}),Object(w.jsx)("p",{children:'The experiment trials are identical to the practice trials you have just completed. In each trial, you will see two pictures with a sound icon below them. Click the sound icon and listen to the voice recording. After listening to the entire recording, click the picture that better matches the meaning that the voice seems to express, according to your intuition or "feeling." If you are unsure, you may listen again, by re-clicking the sound icon. Once you click one of the pictures, you will move to the next screen.'}),Object(w.jsx)("p",{children:'If you have any questions regarding the procedure, please contact the experimenter now. If everything is clear, press "proceed" and the experiment will immediately begin.'})]}),trial_instruction2:Object(w.jsx)(s.a.Fragment,{children:Object(w.jsx)("p",{children:"Please click the picture that better matches the meaning that the voice seems to express. You may listen to the voice again, by clicking its icon."})}),trial_confirm:Object(w.jsx)(s.a.Fragment,{children:Object(w.jsxs)("p",{children:["Are you sure? Click ",Object(w.jsx)("em",{children:"yes"})," or ",Object(w.jsx)("em",{children:"no"}),"."]})}),no_confirmation:Object(w.jsx)(s.a.Fragment,{children:Object(w.jsx)("p",{children:"Please try again."})}),pause:Object(w.jsx)("p",{children:'You may now take a short break. When you want to proceed, press the "proceed" box below.'}),finish:Object(w.jsxs)(s.a.Fragment,{children:[Object(w.jsx)("p",{children:"Thank you! You have completed this session."}),Object(w.jsx)("p",{children:"Please contact the experimenter to ensure your data is uploaded and schedule the next session."})]}),finish_success:"Done uploading data!",finish_wait:"Please wait while uploading data...",error_no_user_sheet:"Can't find a data sheet for participant id ",error_no_connection:"Can't connect. Please check your internet connection and try again.",error_2nd_session_over:"A participant with this participant id has already completed the experiment.",error_no_subject_settings:" Can't find previous settings for participant id ",error_occurred:"An error has occurred",loading:"Loading..."},N=E,I=function(){return Object(w.jsx)("div",{className:"containter text-center",children:Object(w.jsx)("p",{className:"lead",children:N.loading})})},T=function(e){var t=e.error;return Object(w.jsx)("div",{className:"container",children:Object(w.jsx)("div",{className:"row",children:Object(w.jsxs)("div",{className:"col-sm",children:[Object(w.jsxs)("p",{children:[N.error_occurred,":"]}),Object(w.jsx)("p",{className:"lead center",children:t})]})})})},A=function(e){var t=e.info,i=e.next,n=e.continue_disabled,s=e.continue_label;return Object(w.jsxs)("div",{className:"container",children:[Object(w.jsx)("div",{className:"row",children:Object(w.jsx)("div",{className:"col-md-8 offset-md-2 infotext",children:t})}),Object(w.jsxs)("div",{className:"row",children:[Object(w.jsx)("div",{className:"col"}),Object(w.jsxs)("div",{className:"col text-center",children:[Object(w.jsx)("br",{}),Object(w.jsx)(P,{next:i,disabled:n,label:s})]}),Object(w.jsx)("div",{className:"col"})]})]})},C=function(e){var t=e.label,i=e.onClick;return e.disabled?Object(w.jsx)("button",{type:"button",className:"btn btn-primary",onClick:i,disabled:!0,children:t}):Object(w.jsx)("button",{type:"button",className:"btn btn-primary",onClick:i,children:t})},P=function(e){var t=e.next,i=e.label,n=e.disabled;return Object(w.jsx)(C,{label:i||"\u05d4\u05de\u05e9\u05da",onClick:t,disabled:n})},L=function(e){var t=e.id,i=e.options;return e.disabled?Object(w.jsxs)("select",{id:t,name:t,defaultValue:"",disabled:!0,children:[Object(w.jsx)("option",{disabled:!0,value:""}),i.map((function(e){return Object(w.jsx)("option",{value:e,children:e},e)}))]}):Object(w.jsxs)("select",{id:t,name:t,defaultValue:"",children:[Object(w.jsx)("option",{disabled:!0,value:""}),i.map((function(e){return Object(w.jsx)("option",{value:e,children:e},e)}))]})},M=i(5),H=E,B=function(e){var t=e.next,i=e.data,n=s.a.useState(null),a=Object(M.a)(n,2),r=a[0],c=a[1];return Object(w.jsxs)("div",{className:"container",children:[Object(w.jsx)("div",{className:"row breathing-top",children:Object(w.jsx)("div",{className:"col-4 offset-4",children:Object(w.jsx)("table",{children:Object(w.jsxs)("tbody",{children:[Object(w.jsxs)("tr",{children:[Object(w.jsx)("th",{children:E.subject_id_label}),Object(w.jsx)("td",{children:Object(w.jsx)("input",{type:"text",id:"id_input"})})]}),Object(w.jsxs)("tr",{children:[Object(w.jsx)("th",{children:E.group_label}),Object(w.jsx)("td",{children:Object(w.jsx)(L,{id:"group_input",options:H.group_options})})]})]})})})}),Object(w.jsx)("div",{className:"row",children:Object(w.jsxs)("div",{className:"col text-center breathing-top",children:[Object(w.jsx)(P,{next:function(){var e=document.getElementById("id_input"),n=document.getElementById("group_input");""!==e.value&&""!==n.value?(i.id=e.value,i.group=n.value,t()):c("Please select group and participant number.")},label:H.continue_label}),Object(w.jsx)("div",{className:"error",children:r})]})})]})},R=E,F=function(e){var t=e.next,i=e.data,n=s.a.useState(null),a=Object(M.a)(n,2),r=a[0],c=a[1],o=function(){return c(R.subject_data.validation)},l=r?Object(w.jsx)("div",{className:"error",children:r}):null;return Object(w.jsxs)("div",{className:"container",children:[Object(w.jsx)("div",{className:"row",children:Object(w.jsx)("div",{className:"col-md-8 offset-md-2 breathing-top",children:R.subject_data.header})}),Object(w.jsx)("div",{className:"row",children:Object(w.jsx)("div",{className:"col-md-8 offset-md-2",children:Object(w.jsx)("table",{children:Object(w.jsxs)("tbody",{children:[Object(w.jsxs)("tr",{children:[Object(w.jsx)("th",{children:R.subject_data.gender}),Object(w.jsxs)("td",{children:[Object(w.jsx)("input",{type:"radio",id:"male",name:"gender",value:"male"}),Object(w.jsx)("label",{children:R.subject_data.gender_male}),Object(w.jsx)("input",{type:"radio",id:"female",name:"gender",value:"female"}),Object(w.jsx)("label",{children:R.subject_data.gender_female}),Object(w.jsx)("input",{type:"radio",id:"other",name:"gender",value:"other"}),Object(w.jsx)("label",{children:R.subject_data.gender_other})]})]}),Object(w.jsxs)("tr",{children:[Object(w.jsx)("th",{children:R.subject_data.age}),Object(w.jsx)("td",{children:Object(w.jsx)("input",{type:"text",id:"age_input"})})]}),Object(w.jsxs)("tr",{children:[Object(w.jsx)("th",{children:R.subject_data.musical_instrument}),Object(w.jsx)("td",{children:Object(w.jsx)("input",{type:"text",id:"instrument_input"})})]}),Object(w.jsxs)("tr",{children:[Object(w.jsx)("th",{children:R.subject_data.music_theory}),Object(w.jsx)("td",{children:Object(w.jsx)("input",{type:"text",id:"theory_input"})})]}),Object(w.jsxs)("tr",{children:[Object(w.jsx)("th",{children:R.subject_data.musical_activity}),Object(w.jsxs)("td",{children:[Object(w.jsx)("input",{type:"radio",id:"activity_yes",name:"activity",value:"yes"}),Object(w.jsx)("label",{children:R.subject_data.yes}),Object(w.jsx)("input",{type:"radio",id:"activity_no",name:"activity",value:"no"}),Object(w.jsx)("label",{children:R.subject_data.no})]})]}),Object(w.jsxs)("tr",{children:[Object(w.jsx)("th",{children:R.subject_data.musical_activity_specify}),Object(w.jsx)("td",{children:Object(w.jsx)("input",{type:"text",id:"activity_specify_input"})})]}),Object(w.jsxs)("tr",{children:[Object(w.jsx)("th",{children:R.subject_data.acting}),Object(w.jsxs)("td",{children:[Object(w.jsx)("input",{type:"radio",id:"acting_yes",name:"acting",value:"yes"}),Object(w.jsx)("label",{children:R.subject_data.yes}),Object(w.jsx)("input",{type:"radio",id:"acting_no",name:"acting",value:"no"}),Object(w.jsx)("label",{children:R.subject_data.no})]})]})]})})})}),Object(w.jsx)("div",{className:"row",children:Object(w.jsxs)("div",{className:"col text-center font-weight-bold",children:[Object(w.jsx)("br",{}),R.subject_data.done,Object(w.jsx)(P,{label:R.continue_label,next:function(){var e,n=document.getElementById("male"),s=document.getElementById("female"),a=document.getElementById("other");if(n.checked)e=n.value;else if(s.checked)e=s.value;else{if(!a.checked)return void o();e=a.value}var r=document.getElementById("age_input").value,c=document.getElementById("instrument_input").value,l=document.getElementById("theory_input").value;if(""!==r&&""!==c&&""!==l){var d,u=document.getElementById("activity_yes"),p=document.getElementById("activity_no");if(u.checked)d=u.value;else{if(!p.checked)return void o();d=p.value}var h=document.getElementById("activity_specify_input").value;if(""===h&&u.checked)o();else{var _,j=document.getElementById("acting_yes"),b=document.getElementById("acting_no");if(j.checked)_=j.value;else{if(!b.checked)return void o();_=b.value}i.gender=e,i.age=r,i.musical_instrument=c,i.music_theory=l,i.activity=d,i.activity_specify=h,i.acting=_,t()}}else o()}}),l]})})]})};var D=function(e){return e[(t=0,i=e.length-1,Math.floor(Math.random()*(i-t+1)+t))];var t,i},U=function(e){return e.map((function(e){return[Math.random(),e]})).sort((function(e,t){return e[0]-t[0]})).map((function(e){return e[1]}))},G=function(e,t){var i,n=Array(e).fill(0),s=Object(_.a)(t);try{for(s.s();!(i=s.n()).done;){var a=i.value;n[a]?n[a]+=1:n[a]=1}}catch(l){s.e(l)}finally{s.f()}for(var r=[],c=null,o=0;o<e;o++)null===c||n[o]<c?(c=n[o],r=[o]):n[o]===c&&r.push(o);return D(r)},X=function(e,t){if(1===t)return{i:0,k:e};for(var i=t-=1;e>=i&&t>1;)i*=t-1,t-=1;return{i:Math.floor(e/i),k:e%=i}},J={Music:"Mu",Speech:"Sp"},K={English:"E",Hebrew:"H"},z={Single:"Sn",Multiple:"Ml"},Y={Bulo:"B",Tepi:"T"},W={Right:"R",Left:"L"},Q={High:1,Low:2,Ascending:3,Descending:4,Large:5,Small:6,Growing:7,Shrinking:8,Near:9,Far:10,Approaching:11,Receding:12},q=[null,"High","Low","Ascending","Descending","Large","Small","Growing","Shrinking","Near","Far","Approaching","Receding"],V=["Height","Size","Distance"],Z={Height:[1,2,3,4],Size:[5,6,7,8],Distance:[9,10,11,12]},$=function(e){return V[Math.floor((q.indexOf(e)-1)/4)]},ee=["High","Low","Far","Near","Large","Small"],te=["Ascending","Descending","Approaching","Receding","Growing","Shrinking"],ie={High:["Low","Ascending"],Low:["High","Descending"],Ascending:["Descending","High"],Descending:["Ascending","Low"],Large:["Small","Growing"],Small:["Large","Shrinking"],Growing:["Shrinking","Large"],Shrinking:["Growing","Small"],Near:["Far","Approaching"],Far:["Near","Receding"],Approaching:["Receding","Near"],Receding:["Approaching","Far"]},ne=[480,270],se=function(e,t,i,n,s,a,r,c){return"stimuli/audio/"+J[e]+"_"+K[t]+"_"+i+"_"+z[n]+"_"+Y[s]+"_"+a+"_"+W[r]+"_"+Q[c]+".mp3"},ae=function(e,t,i){return"stimuli/images/"+q[Q[e]]+t+W[i]+".jpg"},re=function(e,t,i){return"Music"===e?"English"===t?"Single"===i?"A":"B":"Single"===i?"C":"D":"English"===t?"Single"===i?"E":"F":"Single"===i?"G":"H"},ce=function(e){var t=[];for(var i in z)t.push({medium:"Music",language:"Hebrew",unit_size:i,participant:2,name:re("Music","Hebrew",i)});for(var n in z)t.push({medium:"Speech",language:"Hebrew",unit_size:n,participant:0,name:re("Speech","Hebrew",n)});return U(t)},oe=function(e,t,i,n,s,a){var r=e.filter((function(e){return e[0]===t&&e[2]===i&&e[3]===n+s&&parseInt(e[5])===a}));return 0===r.length?[Array(4).fill(void 0)]:r[0][4]},le=E,de=function(e){var t=e.next,i=e.semantic_fields_permutation,n=e.picture_variant,a=e.picture_orientation,r=s.a.useState(!0),c=Object(M.a)(r,2),o=c[0],l=c[1],d=s.a.useState(0),u=Object(M.a)(d,2),p=u[0],_=u[1],j="picture_samples_";s.a.useEffect((function(){var e=h.a.get(j+"semantic_field");void 0!==e&&null!==e?(_(e),l(h.a.get(j+"in_intro"))):(h.a.set(j+"in_intro",!0),h.a.set(j+"semantic_field",0))}),[]);if(o){var b=ae(D(ee),n,a),m=Object(w.jsx)("img",{src:b,alt:b,width:ne[0],height:ne[1]}),g=ae(D(te),n,a),f=Object(w.jsx)("img",{src:g,alt:g,width:ne[0],height:ne[1]});return Object(w.jsxs)("div",{className:"container",children:[Object(w.jsx)("div",{className:"row",children:Object(w.jsxs)("div",{className:"col-md-8 offset-md-2 infotext picture_imgs",children:[le.picture_samples.intro,Object(w.jsx)("div",{className:"text-center",children:m}),le.picture_samples.other_pictures,Object(w.jsx)("div",{className:"text-center",children:f}),Object(w.jsx)("br",{}),le.picture_samples.proceed]})}),Object(w.jsx)("div",{className:"row",children:Object(w.jsxs)("div",{className:"col text-center",children:[Object(w.jsx)("br",{}),Object(w.jsx)(P,{label:le.continue_label,next:function(){l(!1),h.a.set(j+"in_intro",!1)}})]})})]})}var x=function(e,t){for(var i=[],n=new Set,s=0;s<e;s++)n.add(s);for(var a=0;a<e;a++){var r=Array.from(n),c=X(t,e-a),o=c.i;t=c.k,i.push(r[o]),r.splice(o,1),n=new Set(r)}return i}(3,i),v=V[x[p]],O=Z[v].map((function(e){return q[e]}));console.log(O);var y=O.map((function(e){return ae(e,n,a)})).map((function(e){return Object(w.jsx)("img",{src:e,alt:e,width:ne[0],height:ne[1]},e)})),S=0===p?le.picture_samples.semantic_field_first:le.picture_samples.semantic_field;return Object(w.jsxs)("div",{className:"container",children:[Object(w.jsxs)("div",{className:"row",children:[Object(w.jsx)("div",{className:"col-md-8 offset-md-2 infotext text-center picture_imgs",children:S}),Object(w.jsx)("div",{className:"grid-wrapper",children:y})]}),Object(w.jsxs)("div",{className:"row",children:[Object(w.jsx)("div",{className:"col"}),Object(w.jsxs)("div",{className:"col text-center",children:[Object(w.jsx)("br",{}),Object(w.jsx)(P,{label:le.continue_label,next:2===p?t:function(){_(p+1),h.a.set(j+"semantic_field",p+1)}})]}),Object(w.jsx)("div",{className:"col"})]})]})},ue=i(12),pe=function(){function e(t,i,n){var s=this;Object(c.a)(this,e),this.players=[],this.ids2players={},this.players2ids={};var a,r=Object(_.a)(t);try{var o=function(){var e=a.value,t=s.players.length;if(e in s.ids2players)return"continue";s.ids2players[e]=t,s.players2ids[t]=e;var i=new Audio(e);i.addEventListener("canplaythrough",(function(e){return s.audioLoaded(i)}),!1),i.addEventListener("ended",(function(t){s.onAudioEnded&&s.onAudioEnded(e)}),!1),i.onerror=function(t){console.log("Error loading audio file: "+e+" (error code: "+i.error.code+").")},s.players.push(i)};for(r.s();!(a=r.n()).done;)o()}catch(l){r.e(l)}finally{r.f()}console.log("Loading "+this.players.length+" audio files"),this.loadCount=0,this.onDoneLoading=i,this.onAudioEnded=n}return Object(o.a)(e,[{key:"audioLoaded",value:function(e){this.loadCount+=1,this.loadCount===this.players.length&&this.onDoneLoading&&this.onDoneLoading()}},{key:"play",value:function(e){var t=this.ids2players[e];this.players[t].play().catch((function(e){console.log("Error while playing audio file: "+e)}))}},{key:"stop",value:function(e){var t=this.ids2players[e];this.players[t].pause(),this.players[t].currentTime=0}}]),e}(),he=E,_e=function(e){var t=e.next,i=e.play,n=e.disable_play,s=e.disable_pictures,a=e.pictures,r=e.visual1_location,c=a.map((function(e,i){return Object(w.jsx)("button",{className:"btn btn-outline-primary",onClick:function(){t(0===i)},disabled:s,children:Object(w.jsx)("img",{src:e,alt:e,width:ne[0],height:ne[1]})},e)})),o="Left"===r?c:[c[1],c[0]];return Object(w.jsxs)("div",{className:"container",children:[Object(w.jsx)("div",{className:"row breathing-top",children:Object(w.jsx)("div",{className:"trial_imgs",children:o})}),Object(w.jsx)("div",{className:"row tiny-breathing-top",children:Object(w.jsx)("div",{className:"col-md-8 offset-md-2 text-center",children:Object(w.jsx)("button",{className:"btn btn-outline-success",onClick:i,disabled:n,children:Object(w.jsx)("img",{width:"32",height:"32",src:"exp2021/icons8-speaker-80.png",alt:"play"})})})}),Object(w.jsx)("div",{className:"row tiny-breathing-top",children:Object(w.jsx)("div",{className:"col-md-8 offset-md-2",children:he.trial_instructions})})]})},je=function(e){Object(d.a)(i,e);var t=Object(u.a)(i);function i(e){var n;Object(c.a)(this,i),(n=t.call(this)).ls_prefix="experiment_block_",n.state={trial_idx:0,play_count:0},n.startTrial=function(e){var t=D(["Left","Right"]);if(h.a.set(n.ls_prefix+"visual1_location",t),!n.props.is_practice){var i=new Date;n.trial_time=i.getTime(),n.props.data.trials.push({trial_time:i.toString(),trial:e})}n.setState({play_count:0,trial_idx:e,visual1_location:t}),h.a.set(n.ls_prefix+"trial_idx",e),h.a.set("data",n.props.data)},n.endTrial=function(e){var t=n.state,i=t.trial_idx,s=t.visual1_location;if(!n.props.is_practice){var a=n.props.data.trials,r=n.props.block_stimuli[i];Object.assign(a[a.length-1],{block:n.props.block_idx,block_name:n.props.data.blocks[n.props.block_idx-1+4*(n.props.data.session-1)].name,trial_duration:(new Date).getTime()-n.trial_time,visual1_location:s,is_correct:e}),Object.assign(a[a.length-1],r),h.a.set("data",n.props.data)}},n.nextTrial=function(e){var t=n.state.trial_idx;n.endTrial(e),t+1<n.props.block_stimuli.length?n.startTrial(t+1):n.props.next()},n.playTrial=function(e){var t=n.state.play_count;n.setState({play_count:t+1}),console.log("Playing",n.props.block_stimuli[e].audio),n.props.audio_controller.play(n.props.block_stimuli[e].audio),n.props.set_is_playing(!0)},n.props=e,n.ls_prefix="experiment_block".concat(n.props.block_idx,"_");var s=h.a.get(n.ls_prefix+"trial_idx");return null!==s?(n.state.trial_idx=s,n.continued_trial=!0,n.state.visual1_location=h.a.get(n.ls_prefix+"visual1_location"),n.props.is_practice||(n.trial_time=e.data.trials[e.data.trials.length-1].trial_time)):n.continued_trial=!1,n}return Object(o.a)(i,[{key:"componentDidMount",value:function(){this.continued_trial||this.startTrial(0)}},{key:"render",value:function(){var e=this,t=this.state,i=t.trial_idx,n=t.visual1_location,s=t.play_count;return Object(w.jsx)(_e,{next:this.nextTrial,play:function(){return e.playTrial(i)},disable_play:this.props.is_playing,disable_pictures:0===s||this.props.is_playing,pictures:this.props.block_stimuli[i].pictures,visual1_location:n})}}]),i}(s.a.Component),be=function(e){Object(d.a)(i,e);var t=Object(u.a)(i);function i(e){var n,s=e.data,a=e.exp1_recordings,r=e.next;Object(c.a)(this,i),(n=t.call(this)).ls_prefix="experiment_",n.steps={PRACTICE_INFO:1,PRACTICE_TRIALS:2,EXPERIMENT_INFO:3,EXPERIMENT_BLOCK1:4,PAUSE1:5,EXPERIMENT_BLOCK2:6,PAUSE2:7,EXPERIMENT_BLOCK3:8,PAUSE3:9,EXPERIMENT_BLOCK4:10},n.state={step:1,is_loading:!0,is_playing:!1},n.nextStep=function(){var e=n.state.step;if(e===n.steps.EXPERIMENT_BLOCK4)n.next();else{var t=e+1;h.a.set(n.ls_prefix+"step",t),n.setState({step:t})}},n.next=r,n.data=s;var o=h.a.get(n.ls_prefix+"block_stimuli");if(o){console.log("Continuing experiment block..."),n.block_stimuli=o,n.practice_stimuli=h.a.get(n.ls_prefix+"practice_stimuli");var l=h.a.get(n.ls_prefix+"step");l&&(n.state.step=l)}else n.block_stimuli=n.data.blocks.map((function(e){return function(e,t,i){var n=[];for(var s in Q)for(var a=0,r=[0,1];a<r.length;a++){var c=r[a];for(var o in Y){var l=oe(i,e.unit_size,o,s,t,e.participant),d={audio:se(e.medium,e.language,e.participant+1,e.unit_size,o,t,l,s),pictures:[ae(s,t,l),ae(ie[s][c],t,l)]};Object.assign(d,{exp1_subject:e.participant+1,language:e.language,medium:e.medium,unit_size:e.unit_size,non_word:o,picture_set:t,picture_orientation:l,semantic_field:$(s),correct_meaning:s,compared_meaning:ie[s][c]}),console.log(s),n.push(d)}}return U(n)}(e,n.data.picture_variant,a)})),n.practice_stimuli=U(n.block_stimuli.map((function(e){return D(e)})).flat(1)),h.a.set(n.ls_prefix+"block_stimuli",n.block_stimuli),h.a.set(n.ls_prefix+"practice_stimuli",n.practice_stimuli);console.log("block_stimuli\n",n.block_stimuli),console.log("practice_stimuli\n",n.practice_stimuli);var d=4*(n.data.session-1);return n.session_block_stimuli=n.block_stimuli.slice(d,d+4),console.log("blocks for session",n.data.session,"\n",n.data.blocks.slice(d,d+4)),n}return Object(o.a)(i,[{key:"componentDidMount",value:function(){var e=this,t=[].concat(Object(ue.a)(this.session_block_stimuli.flat(1).map((function(e){return e.audio}))),Object(ue.a)(this.practice_stimuli.map((function(e){return e.audio}))));this.audio_controller=new pe(t,(function(){console.log("Done loading audio files."),e.setState({is_loading:!1})}),(function(){e.setState({is_playing:!1})}))}},{key:"render",value:function(){var e=this,t=this.state,i=t.step,n=t.is_loading,s=t.is_playing;if(n)return Object(w.jsx)(I,{});switch(i){case this.steps.PRACTICE_INFO:return Object(w.jsx)(A,{info:he.practice_info,continue_label:he.continue_label,next:this.nextStep});case this.steps.PRACTICE_TRIALS:return Object(w.jsx)(je,{next:this.nextStep,data:this.data,is_playing:s,set_is_playing:function(t){return e.setState({is_playing:t})},is_practice:!0,block_stimuli:this.practice_stimuli,block_idx:0,audio_controller:this.audio_controller});case this.steps.EXPERIMENT_INFO:return Object(w.jsx)(A,{info:he.experiment_info,continue_label:he.continue_label,next:this.nextStep});case this.steps.EXPERIMENT_BLOCK1:return Object(w.jsx)(je,{next:this.nextStep,data:this.data,is_playing:s,set_is_playing:function(t){return e.setState({is_playing:t})},is_practice:!1,block_stimuli:this.session_block_stimuli[0],block_idx:1,audio_controller:this.audio_controller});case this.steps.PAUSE1:return Object(w.jsx)(A,{info:he.pause,continue_label:he.continue_label,next:this.nextStep});case this.steps.EXPERIMENT_BLOCK2:return Object(w.jsx)(je,{next:this.nextStep,data:this.data,is_playing:s,set_is_playing:function(t){return e.setState({is_playing:t})},is_practice:!1,block_stimuli:this.session_block_stimuli[1],block_idx:2,audio_controller:this.audio_controller});case this.steps.PAUSE2:return Object(w.jsx)(A,{info:he.pause,continue_label:he.continue_label,next:this.nextStep});case this.steps.EXPERIMENT_BLOCK3:return Object(w.jsx)(je,{next:this.nextStep,data:this.data,is_playing:s,set_is_playing:function(t){return e.setState({is_playing:t})},is_practice:!1,block_stimuli:this.session_block_stimuli[2],block_idx:3,audio_controller:this.audio_controller});case this.steps.PAUSE3:return Object(w.jsx)(A,{info:he.pause,continue_label:he.continue_label,next:this.nextStep});case this.steps.EXPERIMENT_BLOCK4:return Object(w.jsx)(je,{next:this.nextStep,data:this.data,is_playing:s,set_is_playing:function(t){return e.setState({is_playing:t})},is_practice:!1,block_stimuli:this.session_block_stimuli[3],block_idx:4,audio_controller:this.audio_controller});default:return null}}}]),i}(s.a.Component),me=E,ge=function(e){var t=e.done_saving,i=e.data_save_error;return Object(w.jsx)("div",{className:"container",children:Object(w.jsxs)("div",{className:"col-md-8 offset-md-2 finish-screen",children:[me.finish,Object(w.jsx)("p",{className:"font-weight-bold",children:t?me.finish_success:me.finish_wait}),Object(w.jsx)("p",{className:"alert-error",children:i})]})})},fe=function(e){Object(d.a)(i,e);var t=Object(u.a)(i);function i(){var e;Object(c.a)(this,i);for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return(e=t.call.apply(t,[this].concat(s))).conn={spreadsheet_id:"1O3uiSh1z1V2UjcxOu6FfelqUrgZRI2HNBQ2f12jjjjg",api_key:"AIzaSyDHFHbGy_GhEt1Q4FW61YYEX2jk3hZcSoQ",write_url:"https://script.google.com/macros/s/AKfycbwQHtJwrLIE4_Ry5uDXtH1hZJg6xvUNUP-8kBqYTtGs2gENHMlbyFNE13CYXaMdx0H3vQ/exec"},e.steps={LOGIN:1,SUBJECT_DATA:2,INTRO:3,PICTURE_SAMPLES:4,EXPERIMENT_BLOCKS:5,FINISH:6},e.state={step:1,error:null,data_save_error:null,loading:!1},e.data={trials:[]},e.nextStep=function(){var t=e.state.step;e.setStep(t+1)},e.stepWillChange=function(t,i){return t===e.steps.LOGIN?e.handle_login():t===e.steps.SUBJECT_DATA&&h.a.set("data",e.data),null},e.setStep=function(t){var i=e.state.step;if(t!==i){var n=e.stepWillChange(i,t);n&&(t=n),t>2&&h.a.set("step",t),e.setState({step:t}),e.stepChanged(t)}},e.stepChanged=function(t){t===e.steps.FINISH&&e.save_data()},e.check_for_subject_sheet=function(){return k(e.conn,e.data.id).then((function(t){return!!t||(e.setState({error:me.error_no_user_sheet+e.data.id,loading:!1}),!1)})).catch((function(t){e.setState({error:me.error_no_connection+" ("+t+")."})}))},e.load_exp1_recordings=function(){return m.read(e.conn,"PilotFirstExperimentTrials","B2:G769").then((function(e){return e.json()})).then((function(t){return e.exp1_recordings=t.values}))},e.handle_login=function(){e.setState({loading:!0}),e.check_for_subject_sheet().then((function(t){t&&S(e.conn).then((function(t){var i=t.filter((function(t){return t.id===e.data.id}));if(0===i.length)e.start_new_session(1);else{var n=i[i.length-1],s=parseInt(n.session);n.event!==v?e.continue_session(s):1===s?e.setState({error:me.error_2nd_session_over,loading:!1}):e.start_new_session(2)}})).catch((function(t){e.setState({error:me.error_no_connection+" ("+t+")."})}))}))},e.start_new_session=function(t){console.log("Start new session:",t),e.data.session=t;var i=function(){console.log("Clearing local storage"),h.a.clear(),h.a.set("data",e.data),2===t&&e.state.step===e.steps.SUBJECT_DATA&&e.nextStep(),e.load_exp1_recordings().then((function(){h.a.set("exp1_recordings",e.exp1_recordings),e.setState({loading:!1})}))};y(e.conn,e.data,f),1===t?e.generate_subject_settings().then((function(){e.setState({loading:!1}),i()})):e.load_subject_settings().then(i)},e.continue_session=function(t){console.log("Continue session:",t);var i=h.a.get("data");if(i&&i.id===e.data.id){e.data=i,y(e.conn,e.data,x),e.load_subject_settings().then((function(){return e.setState({loading:!1})}));var n=h.a.get("exp1_recordings");n?e.exp1_recordings=n:e.load_exp1_recordings();var s=h.a.get("step");s&&(s===e.steps.SUBJECT_DATA&&2===t?e.setStep(s+1):e.setStep(s))}else e.start_new_session(t)},e.generate_subject_settings=function(){return m.read(e.conn,"Subjects","A2:I10000").then((function(e){return e.json()})).then((function(t){if(t.values){var i=t.values,n=i.filter((function(t){return t[1]===e.data.group})),s=i.map((function(e){return e[2]}));e.data.picture_samples_order=G(6,s),n.length,e.data.picture_variant=1;var a=i.map((function(e){return e[4]}));if(e.data.left_picture=G(2,a),0===n.length){var r=U([0,1,2,3,4,5,6,7]);e.data.subject_Mu_E=r[0],e.data.subject_Mu_H=r[1],e.data.subject_Sp_E=r[2],e.data.subject_Sp_H=r[3]}else{var c=n.map((function(e){return e[5]})),o=n.map((function(e){return e[6]})),l=n.map((function(e){return e[7]})),d=n.map((function(e){return e[8]}));e.data.subject_Mu_E=G(8,c),e.data.subject_Mu_H=G(8,o),e.data.subject_Sp_E=G(8,l),e.data.subject_Sp_H=G(8,d)}}else{e.data.picture_samples_order=0,e.data.picture_variant=1,e.data.left_picture=0;var u=U([0,1,2,3,4,5,6,7]);e.data.subject_Mu_E=u[0],e.data.subject_Mu_H=u[1],e.data.subject_Sp_E=u[2],e.data.subject_Sp_H=u[3]}e.data.blocks=ce(e.data);var p=Object.assign({},e.data);return p.blocks=JSON.stringify(p.blocks),m.write(e.conn,"Subjects",p)}))},e.load_subject_settings=function(){return m.read(e.conn,"Subjects","A2:J10000").then((function(e){return e.json()})).then((function(t){if(t.values){var i=t.values.filter((function(t){return t[0]===e.data.id}));if(0===i.length)e.setState({error:me.error_no_subject_settings+e.data.id});else{var n=i[i.length-1];e.data.group=n[1],e.data.picture_samples_order=n[2],e.data.picture_variant=n[3],e.data.left_picture=n[4],e.data.subject_Mu_E=n[5],e.data.subject_Mu_H=n[6],e.data.subject_Sp_E=n[7],e.data.subject_Sp_H=n[8],e.data.blocks=JSON.parse(n[9])}}else e.setState({error:me.error_no_subject_settings+e.data.id})}))},e.save_data=function(){e.data.end_time=(new Date).toString(),e.data.trials.forEach((function(t){t.id=e.data.id,t.session=e.data.session,t.start_time=e.data.start_time,t.end_time=e.data.end_time,1===e.data.session&&(t.gender=e.data.gender,t.age=e.data.age,t.musical_instrument=e.data.musical_instrument,t.music_theory=e.data.music_theory,t.activity=e.data.activity,t.activity_specify=e.data.activity_specify,t.acting=e.data.acting)})),console.log(e.data);var t=Object(l.a)(e);m.write(e.conn,e.data.id,e.data.trials).then((function(i){t.setState({done_saving:!0}),y(e.conn,e.data,v)})).catch(e.show_data_save_error)},e}return Object(o.a)(i,[{key:"componentDidMount",value:function(){this.data.start_time=(new Date).toString()}},{key:"render",value:function(){var e=this.state,t=e.step,i=e.loading,n=e.error;if(n)return Object(w.jsx)(T,{error:n});if(i)return Object(w.jsx)(I,{});switch(t){case this.steps.LOGIN:return Object(w.jsx)(B,{next:this.nextStep,data:this.data},t);case this.steps.SUBJECT_DATA:return Object(w.jsx)(F,{next:this.nextStep,data:this.data},t);case this.steps.INTRO:return Object(w.jsx)(A,{next:this.nextStep,info:me.introduction,continue_label:me.continue_label},t);case this.steps.PICTURE_SAMPLES:return Object(w.jsx)(de,{next:this.nextStep,semantic_fields_permutation:this.data.picture_samples_order,picture_variant:this.data.picture_variant,picture_orientation:D(["Right","Left"])},t);case this.steps.EXPERIMENT_BLOCKS:return Object(w.jsx)(be,{next:this.nextStep,data:this.data,exp1_recordings:this.exp1_recordings},t);case this.steps.FINISH:return Object(w.jsx)(ge,{done_saving:this.state.done_saving},t);default:return null}}}]),i}(s.a.Component),xe=function(e){e&&e instanceof Function&&i.e(3).then(i.bind(null,27)).then((function(t){var i=t.getCLS,n=t.getFID,s=t.getFCP,a=t.getLCP,r=t.getTTFB;i(e),n(e),s(e),a(e),r(e)}))};r.a.render(Object(w.jsx)(s.a.StrictMode,{children:Object(w.jsx)(fe,{})}),document.getElementById("root")),xe()}},[[26,1,2]]]);
//# sourceMappingURL=main.cebca5ab.chunk.js.map